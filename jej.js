// const Flatten = globalThis["@flatten-js/core"];
import Flatten from '@flatten-js/core';
const { Polygon } = Flatten;
const { unify } = Flatten.BooleanOperations;

/* minimal way to generate error.
   try skipping anything on 0?
var world = [
    [-2.23706797749979, 0, -1.118033988749895, 0],
    [-2.23606797749979, 4, -5.5901699437494745, -2],
    [-3.3541019662496847, 0, -3.913118960624632, -1],
];
*/

var world = [
    [-0.5590169943749475, 5, 1.6770509831248424, 5],
    [-2.23606797749979, 4, -1.118033988749895, 4],
    [0, 4, 3.3541019662496847, 4],
    [0.5590169943749475, 3, 2.7950849718747373, 3],
    [3.913118960624632, 3, 5.031152949374527, 3],
    [-1.118033988749895, 2, 1.118033988749895, 2],
    [-3.913118960624632, 1, -1.6770509831248424, 1],
    [-0.5590169943749475, 1, 1.6770509831248424, 1],
    [2.7950849718747373, 1, 3.913118960624632, 1],
    [-2.23606797749979, 0, -1.118033988749895, 0],
    [1.118033988749895, 0, 3.3541019662496847, 0],
    [-3.913118960624632, -1, -2.7950849718747373, -1],
    [0.5590169943749475, -1, 3.913118960624632, -1],
    [-4.47213595499958, -2, -2.23606797749979, -2],
    [1.118033988749895, -2, 2.23606797749979, -2],
    [-5.031152949374527, -3, -3.913118960624632, -3],
    [-2.7950849718747373, -3, -0.5590169943749475, -3],
    [0.5590169943749475, -3, 1.6770509831248424, -3],
    [-3.3541019662496847, -4, -1.118033988749895, -4],
    [0, -4, 2.23606797749979, -4],
    [-1.6770509831248424, -5, 0.5590169943749475, -5],
    [-2.23606797749979, 4, -5.5901699437494745, -2],
    [-0.5590169943749475, 5, -1.118033988749895, 4],
    [-3.3541019662496847, 0, -3.913118960624632, -1],
    [0, 4, -0.5590169943749475, 3],
    [-1.118033988749895, 2, -1.6770509831248424, 1],
    [-2.23606797749979, 0, -2.7950849718747373, -1],
    [-3.3541019662496847, -2, -3.913118960624632, -3],
    [-0.5590169943749475, 1, -1.118033988749895, 0],
    [-1.6770509831248424, -1, -2.23606797749979, -2],
    [1.6770509831248424, 3, 1.118033988749895, 2],
    [-0.5590169943749475, -1, -1.6770509831248424, -3],
    [2.23606797749979, 2, 1.6770509831248424, 1],
    [-0.5590169943749475, -3, -1.118033988749895, -4],
    [3.3541019662496847, 2, 2.7950849718747373, 1],
    [1.118033988749895, -4, 0.5590169943749475, -5],
    [5.5901699437494745, 2, 2.23606797749979, -4],
    [-5.5901699437494745, -2, -5.031152949374527, -3],
    [-3.913118960624632, -3, -3.3541019662496847, -4],
    [-2.23606797749979, -4, -1.6770509831248424, -5],
    [-2.7950849718747373, 3, -2.23606797749979, 2],
    [-1.118033988749895, 0, 0.5590169943749475, -3],
    [-1.6770509831248424, 3, -1.118033988749895, 2],
    [0, 0, 1.118033988749895, -2],
    [1.6770509831248424, 1, 2.23606797749979, 0],
    [1.6770509831248424, 5, 2.23606797749979, 4],
    [2.7950849718747373, 3, 3.3541019662496847, 2],
    [3.3541019662496847, 4, 3.913118960624632, 3],
    [4.47213595499958, 2, 5.031152949374527, 1],
    [5.031152949374527, 3, 5.5901699437494745, 2]
];

var acc = new Polygon([]);
var p;
for (var i = 0; i < world.length; i++) {
    if (world[i][0] == 0 && world[i][2] == 0) {
        continue;
    }
    if (world[i][1] == 0 && world[i][3] == 0) {
        continue;
    }
    p = new Polygon([
        [world[i][0], world[i][1]],
        [world[i][0] * 100, world[i][1] * 100],
        [world[i][2] * 100, world[i][3] * 100],
        [world[i][2], world[i][3]]
    ]);
    console.log(world[i]);
    acc = unify(acc, p);
}

console.log(acc.svg());
